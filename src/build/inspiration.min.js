(function(){var T,t=t||{},ja=ja||{},G=G||{},u=u||{},ka=ka||{};t.Events={bind:function(a,b){for(var c=a.split(" "),d=0,e=c.length;d<e;d++)a=c[d],this._callbacks||(this._callbacks={}),(this._callbacks[a]||(this._callbacks[a]=[])).push(b);return this},unbind:function(a,b){var c;if(a){if(c=this._callbacks)if(b){c=c[a];if(!c)return this;for(var d=0,e=c.length;d<e;d++)if(b===c[d]){c.splice(d,1);break}}else c[a]=[]}else this._callbacks={};return this},trigger:function(a){var b,c,d,e;if(!(c=this._callbacks))return this;
if(b=c[a]){d=0;for(e=b.length;d<e;d++)b[d].apply(this,Array.prototype.slice.call(arguments,1))}if(b=c.all){d=0;for(e=b.length;d<e;d++)b[d].apply(this,arguments)}return this}};var B=Array.prototype,Ia=Object.prototype.hasOwnProperty,x=B.slice,la=B.forEach,ma=B.indexOf,na=B.map,oa=B.filter,pa=B.some,U=Function.prototype.bind,qa=function(){},V={},ra=function(a,b){return Ia.call(a,b)},H=function(a,b,c){if(null!=a)if(la&&a.forEach===la)a.forEach(b,c);else if(a.length===+a.length)for(var d=0,e=a.length;d<
e&&!(d in a&&b.call(c,a[d],d,a)===V);d++);else for(d in a)if(ra(a,d)&&b.call(c,a[d],d,a)===V)break},sa=function(a){return a},ta=function(a,b,c){c||(c=sa);for(var d=0,e=a.length;d<e;){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},ua=common={has:ra,each:H,compact:function(a){var b=function(a){return!!a},c=[];null==a?a=c:oa&&a.filter===oa?a=a.filter(b,void 0):(H(a,function(a,e,f){b.call(void 0,a,e,f)&&(c[c.length]=a)}),a=c);return a},bind:function(a,b){var c,d;if(a.bind===U&&U)return U.apply(a,x.call(arguments,
1));if(!this.isFunction(a))throw new TypeError;d=x.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,d.concat(x.call(arguments)));qa.prototype=a.prototype;var e=new qa,f=a.apply(e,d.concat(x.call(arguments)));return Object(f)===f?f:e}},bindAll:function(a){var b=x.call(arguments,1);0==b.length&&(b=this.functions(a));this.each(b,function(b){a[b]=this.bind(a[b],a)},this);return a},functions:function(a){var b=[],c;for(c in a)this.isFunction(a[c])&&b.push(c);return b.sort()},
extend:function(a){H(x.call(arguments,1),function(b){for(var c in b)a[c]=b[c]});return a},map:function(a,b,c){var d=[];if(null==a)return d;if(na&&a.map===na)return a.map(b,c);H(a,function(a,f,g){d[d.length]=b.call(c,a,f,g)});a.length===+a.length&&(d.length=a.length);return d},any:function(a,b,c){b||(b=this.identity);var d=!1;if(null==a)return d;if(pa&&a.some===pa)return a.some(b,c);H(a,function(a,f,g){if(d||(d=b.call(c,a,f,g)))return V});return!!d},indexOf:function(a,b,c){if(null==a)return-1;var d;
if(c)return c=ta(a,b),a[c]===b?c:-1;if(ma&&a.indexOf===ma)return a.indexOf(b);c=0;for(d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1},sortedIndex:ta,identity:sa,after:function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}},debounce:function(a,b,c){var d;return function(){var e=this,f=arguments;c&&!d&&a.apply(e,f);clearTimeout(d);d=setTimeout(function(){d=null;c||a.apply(e,f)},b)}},clone:function(a){return!this.isObject(a)?a:this.isArray(a)?a.slice():this.extend({},
a)},isElement:function(a){return!!(a&&1==a.nodeType)},isArray:Array.isArray||function(a){return"[object Array]"==toString.call(a)},toArray:function(a){return!a?[]:this.isArray(a)||this.isArguments(a)?x.call(a):a.toArray&&this.isFunction(a.toArray)?a.toArray():this.values(a)},values:function(a){return this.map(a,this.identity)},once:function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}},isObject:function(a){return a===Object(a)},isNumber:function(a){return"[object Number]"==
toString.call(a)},isFunction:function(a){return"[object Function]"==toString.call(a)||"function"==typeof a},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isRegExp:function(a){return"[object RegExp]"==toString.call(a)}},va=[888,813,738,663,588,513,438,363,288,213,138,63],wa=[900,825,750,675,600,525,450,375,300,225,150,75,0];u.grid={gutter:12,width:75,columns:12,getPosition:function(a){return Math.max(Math.min(a,this.columns),0)*this.width},getWidth:function(a){return this.getPosition(a)-
this.gutter},snapWidth:function(a,b){if(0===a)return{x:a,y:b};ua.isUndefined(b)&&(b=0);for(var c=a,d=b,e=0,f=va.length;e<f;e++){var g=va[e];if(g<c){a=g;b=Math.floor(g*d/c);break}}return{x:a,y:b}},snapPosition:function(a,b){if(0===a)return{x:a,y:b};ua.isUndefined(b)&&(b=0);for(var c=a,d=b,e=0,f=wa.length;e<f;e++){var g=wa[e];if(g<c){a=g;b=Math.floor(g*d/c);break}}return{x:a,y:b}}};var Ja=t,Ka=t.Events,La=t,xa,Ma=t.Events,O=common,y=function(){this.handlers=[];O.bindAll(this,"checkUrl")},W=/^[#\/]/,
Na=/msie [\w.]+/;y.started=!1;O.extend(y.prototype,Ma,{interval:50,getHash:function(a){return(a=(a?a.location:window.location).href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||b){var a=window.location.pathname,c=window.location.search;c&&(a+=c)}else a=this.getHash();a.indexOf(this.options.root)||(a=a.substr(this.options.root.length));return a.replace(W,"")},start:function(a){if(y.started)throw Error("history has already been started");y.started=!0;this.options=
O.extend({},{root:"/"},this.options,a);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var a=this.getFragment(),b=document.documentMode;if(b=Na.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b))this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?$(window).bind("popstate",this.checkUrl):
this._wantsHashChange&&"onhashchange"in window&&!b?$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=window.location;b=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&(this._hasPushState&&b&&a.hash)&&(this.fragment=
this.getHash().replace(W,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);y.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));
if(a==this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return O.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!y.started)return!1;if(!b||!0===b)b={};var c=(a||"").replace(W,"");this.fragment!=c&&(this._hasPushState?(0!=c.indexOf(this.options.root)&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},
document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.silent||this.loadUrl(a))},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});xa=new y;var C=La.History=xa,X=common,Y=function(a){a||(a=
{});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)};Y.history=C;var Oa=/:\w+/g,Pa=/\*\w+/g,Qa=/[-[\]{}()+?.,\\^$|#\s]/g;X.extend(Y.prototype,Ka,{initialize:function(){},route:function(a,b,c){C||(C=new History);X.isRegExp(a)||(a=this._routeToRegExp(a));c||(c=this[b]);C.route(a,X.bind(function(d){d=this._extractParameters(a,d);c&&c.apply(this,d);this.trigger.apply(this,["route:"+b].concat(d));C.trigger("route",this,b,d)},this));return this},navigate:function(a,
b){C.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(Qa,"\\$&").replace(Oa,"([^/]+)").replace(Pa,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var Z=Ja.Router=Y,Ra=common,aa=[],v={loaded:aa,querying:!1,limit:10,cursor:0,total_records:0,total_pages:0,getAssetsForUser:function(a,
b,c){this.querying=!0;a="https://gimmebar.com/api/v1/public/assets/"+a+("?skip="+this.cursor*this.limit)+("&limit="+this.limit);if(0<=Ra.indexOf(aa,this.cursor))return!1;$.get("../php/get.php?q="+a,function(a){var a=JSON.parse(a),e=a.total_records;e&&v.total_records!==e&&(v.total_records=a.total_records,v.total_pages=Math.floor(v.total_records/v.limit));c||aa.push(v.cursor);b(a);v.querying=!1});return!0}},h=ja.api=v,Sa=G,P=u.grid,i=common,ba=function(){this.birthday=Math.round(Date.now()/1E3);this.$el=
$('<div class="stage"/>');this.domElement=this.$el[0];this.offset={x:P.getPosition(2),y:0};this.range={min:0,max:0}};i.extend(ba,{Id:"s-"});i.extend(ba.prototype,{appendTo:function(a){if(!i.isElement(a))return this;a.appendChild(this.domElement);i.extend(a.style,{overflow:"hidden"});return this},setGallery:function(a){this.gallery=a;return this},setMinimap:function(a){this.minimap=a;return this},place:function(a){var b;b=this.offset.x;var c=Math.round((this.birthday-a.date)/10-this.offset.y);if(0!==
a.id&&i.isArray(a.neighbors)){for(var d=0,e=a.neighbors.length;d<e;d++){var f=a.neighbors[d];if(!i.isUndefined(f.top)&&!i.isUndefined(f.left)){var g=f.left,h=g+(f.width||0),j=f.top,f=j+(f.height||0);if(b+(a.width||0)>=g&&b<=h&&c+(a.height||0)>=j&&c<=f)if(g=P.snapPosition(h+P.width).x,900>g+(a.width||0)&&g>b)b=g}}d=0;for(e=a.neighbors.length;d<e;d++)if(f=a.neighbors[d],!i.isUndefined(f.top)&&!i.isUndefined(f.left)&&(g=f.left,h=g+(f.width||0),j=f.top,f=j+(f.height||0),b+(a.width||0)>=g&&b<=h&&c+(a.height||
0)>=j&&c<=f))c<f&&(c=f+P.gutter)}c>this.range.max&&(this.range.max=c);if(c<this.range.min||0===this.range.min)this.range.min=c;b={left:b,top:c};var D=$("<div />").addClass("moment").attr("model",a.id).css({position:"absolute",background:"#d1d1d1"}).appendTo(this.domElement);a.href&&D.html('<a href="'+a.href+'"></a>');c=function(){D.css({top:a.top+"px",left:a.left+"px",width:a.width+"px",height:a.height+"px"})};a.bind("change",c).add(b);c();this.updateDisplay();return D[0]},update:function(a,b){var c=
a+b;i.each(this.gallery.models,function(b){var e=b.top-this.range.min,f=e+b.height,g=this.$el.find("[model="+b.id+"]");0<g.length&&(e>c||f<a?(g.removeClass("visible"),this.gallery.hideImage(b,g[0])):(g.addClass("visible"),this.gallery.getImageForModel(b,g[0])))},this)},updateDisplay:function(){i.extend(this.domElement.style,{marginTop:-this.range.min+"px",height:this.range.max+"px"})}});var Ta=Sa.Stage=ba,Ua=G,Va=u,Q=common,I=!1,ca=document.createElement("div"),ya=$(ca).css("display","block").addClass("loader"),
za=document.createElement("img");za.src="../images/loader.gif";ca.appendChild(za);var Wa=Va.loader={domElement:ca,isVisible:function(){return!I},show:function(a){if(!I)return this;ya.fadeIn(150,function(){I=!1;(Q.isFunction(a)?a:Q.identity)()})},hide:function(a){if(I)return this;ya.fadeOut(150,function(){I=!0;(Q.isFunction(a)?a:Q.identity)()})}},Aa=u.grid,Xa=G,z=common,R=ka.utils={svgns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",createElement:function(a,b){var c=document.createElementNS(this.svgns,
a);b&&this.setAttributes(c,b);return c},createImage:function(a){var b=this.createElement("image");b.setAttributeNS(this.xlinkns,"href",a);return b},createUse:function(a){var b=this.createElement("use");b.setAttributeNS(this.xlinkns,"href","#"+a);return b},setClass:function(a,b){a.getAttribute("class")!==b&&a.setAttribute("class",b)},addClass:function(a,b){var c=a.getAttribute("class");null===c?a.setAttribute("class",b):c!==b&&(c=c.split(/ +/),-1==c.indexOf(b)&&(c.push(b),a.setAttribute("class",c.join(" "))));
return this},bezierString:function(a,b,c,d,e,f,g,h){return"M"+a.toFixed(10)+","+b.toFixed(10)+" C"+c.toFixed(10)+","+d.toFixed(10)+" "+e.toFixed(10)+","+f.toFixed(10)+" "+g.toFixed(10)+" "+h.toFixed(10)},removeClass:function(a,b){var c=a.getAttribute("class");if(null!==c){if(c===b)a.setAttribute("class","");else{var c=c.split(/ +/),d=c.indexOf(b);-1!=d&&(c.splice(d,1),a.setAttribute("class",c.join(" ")))}return this}},hasClass:function(a,b){var c=a.getAttribute("class");return RegExp(b).test(c)},
setAttributes:function(a,b){z.each(b,function(b,d){a.setAttribute(d,b)});z.extend(a,b);return this},setTransform:function(){arguments[0].setAttribute("transform",this.transformString.apply(this,z.toArray(arguments).splice(1)))},transformString:function(a){function b(a,b){return a+"("+b.join(" ")+")"}if(z.isArray(a)){var c=[];z.each(z.toArray(arguments),function(a){c.push(b(a[0],a.slice(1)))});return c.join(" ")}return b(arguments[0],z.toArray(arguments).slice(1))}},da=common,m,Ya=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,
Za=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,$a=/[^-+\dA-Z]/g,n=function(a,b){a=String(a);for(b=b||2;a.length<b;)a="0"+a;return a};m=function(a,b,c){1==arguments.length&&("[object String]"==Object.prototype.toString.call(a)&&!/\d/.test(a))&&(b=a,a=void 0);a=a?new Date(a):new Date;if(isNaN(a))throw SyntaxError("invalid date");b=String(m.masks[b]||b||m.masks["default"]);"UTC:"==b.slice(0,4)&&(b=b.slice(4),c=
!0);var d=c?"getUTC":"get",e=a[d+"Date"](),f=a[d+"Day"](),g=a[d+"Month"](),h=a[d+"FullYear"](),j=a[d+"Hours"](),D=a[d+"Minutes"](),k=a[d+"Seconds"](),d=a[d+"Milliseconds"](),i=c?0:a.getTimezoneOffset(),l={d:e,dd:n(e),ddd:m.i18n.dayNames[f],dddd:m.i18n.dayNames[f+7],m:g+1,mm:n(g+1),mmm:m.i18n.monthNames[g],mmmm:m.i18n.monthNames[g+12],yy:String(h).slice(2),yyyy:h,h:j%12||12,hh:n(j%12||12),H:j,HH:n(j),M:D,MM:n(D),s:k,ss:n(k),l:n(d,3),L:n(99<d?Math.round(d/10):d),t:12>j?"a":"p",tt:12>j?"am":"pm",T:12>
j?"A":"P",TT:12>j?"AM":"PM",Z:c?"UTC":(String(a).match(Za)||[""]).pop().replace($a,""),o:(0<i?"-":"+")+n(100*Math.floor(Math.abs(i)/60)+Math.abs(i)%60,4),S:["th","st","nd","rd"][3<e%10?0:(10!=e%100-e%10)*e%10]};return b.replace(Ya,function(a){return a in l?l[a]:a.slice(1,a.length-1)})};m.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",
isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};m.i18n={dayNames:"Sun Mon Tue Wed Thu Fri Sat Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),monthNames:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec January February March April May June July August September October November December".split(" ")};var ab=dateFormat=m,db=function(a){a=Math.sin(a/bb*cb);return"rgb("+Math.floor((p.night.r-p.day.r)*a+p.day.r)+","+Math.floor((p.night.g-
p.day.g)*a+p.day.g)+","+Math.floor((p.night.b-p.day.b)*a+p.day.b)+")"},bb=86400,cb=2*Math.PI,p={day:{r:252,g:192,b:151},night:{r:201,g:192,b:255}},Ba=function(a,b){var c=this;this.width=a||20;this.height=b||20;var d={width:this.width+1,height:this.height+1};this.domElement=document.createElement("div");this.container=R.createElement("svg");this.circle=R.createElement("circle");this.label=$('<p class="day" />');this.container.appendChild(this.circle);this.domElement.appendChild(this.container);this.domElement.appendChild(this.label[0]);
this.__fadeLabelOut=da.debounce(function(){c.label.fadeOut()},2500);R.addClass(this.domElement,"clock").setAttributes(this.container,d).setAttributes(this.circle,{fill:"#fff",cx:d.width/2,cy:d.height/2,r:this.width/2})};da.extend(Ba.prototype,{changeDate:function(a){a=ab(a,"mm/dd/yy").replace(/\//g,"&middot;");this.label.html(a)},getCurrentTime:function(){return this.time-(10*this.offset||0)},setInitialTime:function(a){this.time=a;this.day=0;this.updateDisplay();return this},setTimeByPosition:function(a){this.offset=
a;this.updateDisplay();return this},updateDisplay:function(){if(da.isUndefined(this.time))return this;var a=this.getCurrentTime(),b=new Date(1E3*a);R.setAttributes(this.circle,{fill:db(a)});a=b.toDateString();a!==this.day&&(this.day=a,this.changeDate(b));b=this.label;"none"==b.css("display")&&b.stop().fadeIn(150);this.__fadeLabelOut();return this}});var eb=Xa.Clock=Ba,q=common,ea=$(document);$(window);var Ca=function(){this.width=Aa.getWidth(1);this.gutter=Aa.gutter;this.$el=$('<div class="minimap" />');
this.domElement=this.$el[0];this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d");this.loader=Wa;this.viewport=$('<div class="viewport" />')[0];this.clock=new eb(20,20);this.domElement.appendChild(this.viewport);this.domElement.appendChild(this.canvas);this.domElement.appendChild(this.loader.domElement);this.domElement.appendChild(this.clock.domElement);var a=q.bind(function(){ea.bind("mousemove",b).bind("mouseup",c)},this),b=q.bind(function(a){a.preventDefault();a.stopPropagation();
var b=this.$el.offset();Math.max(Math.min(a.pageX-b.left,this.width),0);a=Math.max(Math.min(a.pageY-b.top,this.height),0);a=this.fromWorldY(a);ea.scrollTop(a)},this),c=q.bind(function(){ea.unbind("mousemove",b).unbind("mouseup",c)},this);$(this.domElement).bind("mousedown",a).bind("mouseup",function(a){b(a);c()})};q.extend(Ca.prototype,{appendTo:function(a){if(!q.isElement(a))return this;a.appendChild(this.domElement);return this},setStage:function(a){this.stage=a;return this},setGallery:function(a){this.gallery=
a;return this},setOffset:function(a,b,c){q.extend(this.domElement.style,{left:a+"px",top:b+"px"});this.clock.setTimeByPosition(c);return this},setHeight:function(a){if(a===this.height)return this;this.height=a;q.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});this.canvas.width=this.width;this.canvas.height=this.height;this.updateDisplay();return this},toWorldX:function(a){return Math.ceil(a/(this.stage.width/this.width))},toWorldY:function(a){return Math.ceil(a/(this.stage.height/
this.height))},fromWorldX:function(a){return Math.ceil(a*(this.stage.width/this.width))},fromWorldY:function(a){return Math.ceil(a*(this.stage.height/this.height))},update:function(){var a=$(this.stage.domElement);this.stage.width=a.width();this.stage.height=a.height()-this.stage.range.min;return this},updateDisplay:function(a,b){this.update();this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="#fff";var c=this.stage.offset.x/2;q.each(this.gallery.models,function(a){var b=
this.toWorldX(a.left-c),f=this.toWorldY(a.top-this.stage.range.min),g=this.toWorldX(a.width),a=this.toWorldY(a.height)+6;this.ctx.fillRect(b,f,g,a)},this);this.updateViewport(a,b);return this},updateViewport:function(a,b){q.extend(this.viewport.style,{top:this.toWorldY(a)+"px",height:this.toWorldY(b)+"px"});return this}});var fb=Ua.Minimap=Ca,gb=G,hb=t,E=common,Da=function(a){E.isObject(a)&&this.add(a)};E.extend(Da.prototype,t.Events,{add:function(a,b){E.each(a,function(a,d){var e=d.charAt(0).toUpperCase()+
d.substring(1).toLowerCase();if(E.isUndefined(this[d]))this[d]=E.isObject(a)?E.clone(a):a,this["get"+e]=function(){return this[d]},this["set"+e]=function(a,b){if(a===this[d])return this;this[d]=a;b||this.trigger("change",d,a);return this};else this["set"+e](a,b)},this);return this}});var ib=hb.Model=Da,Ea=u.grid,jb=u.label={add:function(a,b,c){var d=a.attr("alt"),e=!!c;if(d&&!(0>=d.length)){var c=marked(d),f=$('<div class="label image" />').html(c).appendTo(b||document.body),b=$(b||document.body),
c=function(){var c,d,h;e?c={left:0,top:0}:(d=b.offset().top,c=a.offset(),h=(a.outerWidth()-a.width())/2,d=(a.outerHeight()-a.height())/2-d,c={left:c.left+h+"px",top:c.top+d+"px"});f.css(c).fadeIn(150)},d=function(a){a=$(a.relatedTarget);!a.hasClass("image")&&!a.hasClass("label")&&f.fadeOut(150)};(e?b:a).hover(c,d).bind("touchstart",c).bind("touchend",d);return f}}},A=common,Fa=function(a,b){var c=$(b||"<img />").attr("alt",a.title).css({display:"none"}).bind("load",function(){if(0===a.width){var b=
Math.min(c.width(),Ea.getWidth(11)),d=c.height(),b=Ea.snapWidth(b,d);c.width(b.x).height(b.y);a.setWidth(b.x);a.setHeight(b.y)}jb.add(c,c.parent(),!0);c.fadeIn()}),d=c[0];0!==a.width&&(d.width=a.width);0!==a.height&&(d.height=a.height);d.src=a.url;return d},kb=$(document),Ga=0,J=function(){this.models=[];this.images=[]};A.extend(J,{MaxImages:50,Threshold:3600});A.extend(J.prototype,{add:function(a){a.id=Ga;Ga++;a=new ib(a);this.models.push(a);return a},areNeighbors:function(a,b){return a.neighbors&&
0<a.neighbors.length&&0<=A.indexOf(a.neighbors,b)},isNeighbors:function(a,b){return Math.abs(a.date-b.date)<J.Threshold},makeNeighbors:function(a,b){A.isArray(a.neighbors)||a.add({neighbors:[]});A.isArray(b.neighbors)||b.add({neighbors:[]});a.neighbors.push(b);b.neighbors.push(a)},hideImage:function(a){a=this.getImageById(a.id);A.isElement(a)&&$(a).fadeOut();return this},setStage:function(a){this.stage=a;return this},getImageForModel:function(a,b){var c=this.makeImage(a);b.children[0].appendChild(c);
return this},makeImage:function(a){var b=this.images.length,c=this.getImageById(a.id);if(A.isElement(c))return $(c).fadeIn()[0];if(b<J.MaxImages)return Fa(a);c=this.getImageOffScreen();return Fa(a,c)},getImageOffScreen:function(){for(var a,b=0,c=this.images.length;b<c;b++){var d=this.images[b],e=$(d).parent();0<e.length&&!e.hasClass("visible")&&(a=d)}return a},getImageById:function(a){return kb.find("[model="+a+"] img")[0]}});var lb=gb.Gallery=J,mb=u.grid,K=common,Ha=function(){L||h.cursor===h.total_pages&&
0!==h.total_pages||(L=!0,h.cursor=Math.min(parseInt(h.cursor)+1,h.total_pages),fa.navigate("#/page/"+(h.total_pages-h.cursor)))},ob=function(a){K.each(a.records,function(a){switch(a.asset_type){case "image":var b=a.content.resized_images,c=b.stash,g=b.display,h=c&&K.isObject(c.dims),j=g&&K.isObject(g.dims),i=h?c.dims.w:j?g.dims.w:0,c=h?c.dims.h:j?g.dims.h:0;if(0===i||0===c)break;i=mb.snapWidth(parseInt(i/2),parseInt(c/2));a=k.add({url:b.full,date:a.date,width:i.x,height:i.y,title:a.title,href:a.source});
b=0;for(i=k.models.length;b<i;b++)c=k.models[b],a.id===c.id||(k.areNeighbors(a,c)||!k.isNeighbors(a,c))||k.makeNeighbors(a,c)}});for(var a=0,b=k.models.length;a<b;a++){var c=k.models[a];c.placed||(c.add({placed:!0}),w.place(c))}nb();a=M.height();T=0.9*a;a<=r?Ha():(a=s-N,w.update(a,r),l.updateDisplay(a,r));l.loader.hide();S.trigger("resize");L=!1},S=$(window),M=$(document),ga=M.find("nav"),pb=$("#content")[0],w=(new Ta).appendTo(pb),l=(new fb).appendTo(document.body),k=new lb,fa=new Z,L=!1;fa.route("page/:page",
"page",function(a){var a=parseInt(a),b=h.total_pages-a;if(0>b||h.total_pages&&b>h.total_pages)b=Math.min(Math.max(b,0),h.total_pages),Z.history.navigate("#/page/"+a,{silent:!0});h.cursor!==b&&(h.cursor=b);h.getAssetsForUser("jonobr1",ob)?l.loader.show():L=!1});w.setGallery(k);l.setGallery(k).setStage(w);k.setStage(w);var s=T=0,ha=0,r=S.height(),N=ga.outerHeight(!0),ia=ga.offset(),F,nb=K.once(function(){l.clock.setInitialTime(k.models[0].date)});S.resize(function(){r=S.height();ia=ga.offset();F=Math.max(N-
s,l.gutter);var a=$(w.domElement).offset().top;l.setOffset(ia.left+32-ha,F,s-a).setHeight(r-F-l.gutter)}).trigger("resize");var qb=K.debounce(function(){w.update(s-N,r)},750);M.scroll(function(){var a=M.scrollTop(),b=M.scrollLeft(),c=$(w.domElement).offset().top;s<a&&a+r>T&&Ha();ha=b;s=a;F=Math.max(N-s,l.gutter);l.setOffset(ia.left+32-ha,F,s-c).setHeight(r-F-l.gutter).updateViewport(s-N,r);qb()});h.getAssetsForUser("jonobr1",function(a){h.total_pages=Math.floor(a.total_records/h.limit);Z.history.start({root:"/inspiration/"})||
(L=!0,fa.navigate("#/page/"+(h.total_pages-h.cursor)))},!0)})();