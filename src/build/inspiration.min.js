(function(){var K,L,t=t||{},D=D||{},m=m||{},r=r||{},h=Array.prototype,la=Object.prototype.hasOwnProperty,z=h.slice,S=h.forEach,T=h.indexOf,U=h.map,V=h.filter,M=Function.prototype.bind,W=function(){},X={},Y=function(a,c){return la.call(a,c)},E=function(a,c,b){if(null!=a)if(S&&a.forEach===S)a.forEach(c,b);else if(a.length===+a.length)for(var d=0,f=a.length;d<f&&!(d in a&&c.call(b,a[d],d,a)===X);d++);else for(d in a)if(Y(a,d)&&c.call(b,a[d],d,a)===X)break},Z=function(a){return a},aa=function(a,c,b){b||
(b=Z);for(var d=0,f=a.length;d<f;){var e=d+f>>1;b(a[e])<b(c)?d=e+1:f=e}return d},ba=common={has:Y,each:E,compact:function(a){var c=function(a){return!!a},b=[];null==a?a=b:V&&a.filter===V?a=a.filter(c,void 0):(E(a,function(a,f,e){c.call(void 0,a,f,e)&&(b[b.length]=a)}),a=b);return a},bind:function(a,c){var b,d;if(a.bind===M&&M)return M.apply(a,z.call(arguments,1));if(!this.isFunction(a))throw new TypeError;d=z.call(arguments,2);return b=function(){if(!(this instanceof b))return a.apply(c,d.concat(z.call(arguments)));
W.prototype=a.prototype;var f=new W,e=a.apply(f,d.concat(z.call(arguments)));return Object(e)===e?e:f}},extend:function(a){E(z.call(arguments,1),function(c){for(var b in c)a[b]=c[b]});return a},map:function(a,c,b){var d=[];if(null==a)return d;if(U&&a.map===U)return a.map(c,b);E(a,function(a,e,g){d[d.length]=c.call(b,a,e,g)});a.length===+a.length&&(d.length=a.length);return d},indexOf:function(a,c,b){if(null==a)return-1;var d;if(b)return b=aa(a,c),a[b]===c?b:-1;if(T&&a.indexOf===T)return a.indexOf(c);
b=0;for(d=a.length;b<d;b++)if(b in a&&a[b]===c)return b;return-1},sortedIndex:aa,identity:Z,after:function(a,c){return 0>=a?c():function(){if(1>--a)return c.apply(this,arguments)}},debounce:function(a,c,b){var d;return function(){var f=this,e=arguments;b&&!d&&a.apply(f,e);clearTimeout(d);d=setTimeout(function(){d=null;b||a.apply(f,e)},c)}},clone:function(a){return!this.isObject(a)?a:this.isArray(a)?a.slice():this.extend({},a)},isArray:Array.isArray||function(a){return"[object Array]"==toString.call(a)},
isElement:function(a){return!!(a&&1==a.nodeType)},isObject:function(a){return a===Object(a)},isNumber:function(a){return"[object Number]"==toString.call(a)},isFunction:function(a){return"[object Function]"==toString.call(a)||"function"==typeof a},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a}},ca=[888,813,738,663,588,513,438,363,288,213,138,63],da=[900,825,750,675,600,525,450,375,300,225,150,75,0];m.grid={gutter:12,width:75,columns:12,getPosition:function(a){return Math.max(Math.min(a,
this.columns),0)*this.width},getWidth:function(a){return this.getPosition(a)-this.gutter},snapWidth:function(a,c){if(0===a)return{x:a,y:c};ba.isUndefined(c)&&(c=0);for(var b=a,d=c,f=0,e=ca.length;f<e;f++){var g=ca[f];if(g<b){a=g;c=Math.floor(g*d/b);break}}return{x:a,y:c}},snapPosition:function(a,c){if(0===a)return{x:a,y:c};ba.isUndefined(c)&&(c=0);for(var b=a,d=c,f=0,e=da.length;f<e;f++){var g=da[f];if(g<b){a=g;c=Math.floor(g*d/b);break}}return{x:a,y:c}}};var ma=common,N=[],p={loaded:N,querying:!1,
limit:10,cursor:0,total_records:0,total_pages:0,getAssetsForUser:function(a,c){this.querying=!0;var b="https://gimmebar.com/api/v1/public/assets/"+a+("?skip="+this.cursor*this.limit)+("&limit="+this.limit);0<=ma.indexOf(N,this.cursor)||$.get("../php/get.php?q="+b,function(a){var a=JSON.parse(a),b=a.total_records;b&&p.total_records!==b&&(p.total_records=a.total_records,p.total_pages=Math.floor(p.total_records/p.limit));N.push(p.cursor);p.querying=!1;c(a)})}},j=t.api=p,t=D,F=m.grid,k=common,h=function(){this.birthday=
Math.round(Date.now()/1E3);this.$el=$('<div class="stage"/>');this.domElement=this.$el[0];this.offset={x:F.getPosition(2),y:0};this.range={min:0,max:0}};k.extend(h,{Id:"s-"});k.extend(h.prototype,{appendTo:function(a){if(!k.isElement(a))return this;a.appendChild(this.domElement);k.extend(a.style,{overflow:"hidden"});return this},setGallery:function(a){this.gallery=a;return this},setMinimap:function(a){this.minimap=a;return this},place:function(a){var c;c=this.offset.x;var b=Math.round((this.birthday-
a.date)/10-this.offset.y);if(0!==a.id&&k.isArray(a.neighbors)){for(var d=0,f=a.neighbors.length;d<f;d++){var e=a.neighbors[d];if(!k.isUndefined(e.top)&&!k.isUndefined(e.left)){var g=e.left,h=g+(e.width||0),j=e.top,e=j+(e.height||0);if(c+(a.width||0)>=g&&c<=h&&b+(a.height||0)>=j&&b<=e)if(g=F.snapPosition(h+F.width).x,900>g+(a.width||0)&&g>c)c=g}}d=0;for(f=a.neighbors.length;d<f;d++)if(e=a.neighbors[d],!k.isUndefined(e.top)&&!k.isUndefined(e.left)&&(g=e.left,h=g+(e.width||0),j=e.top,e=j+(e.height||
0),c+(a.width||0)>=g&&c<=h&&b+(a.height||0)>=j&&b<=e))b<e&&(b=e+F.gutter)}b>this.range.max&&(this.range.max=b);if(b<this.range.min||0===this.range.min)this.range.min=b;c={left:c,top:b};var i=$("<div />").addClass("moment").attr("model",a.id).css({position:"absolute",background:"#d1d1d1"}).appendTo(this.domElement);a.href&&i.html('<a href="'+a.href+'"></a>');b=function(){i.css({top:a.top+"px",left:a.left+"px",width:a.width+"px",height:a.height+"px"})};a.bind("change",b).add(c);b();this.updateDisplay();
return i[0]},update:function(a,c){var b=a+c;k.each(this.gallery.models,function(d){var c=d.top-this.range.min,e=c+d.height,g=this.$el.find("[model="+d.id+"]");0<g.length&&(c>b||e<a?(g.removeClass("visible"),this.gallery.hideImage(d,g[0])):(g.addClass("visible"),this.gallery.getImageForModel(d,g[0])))},this)},updateDisplay:function(){k.extend(this.domElement.style,{marginTop:-this.range.min+"px",height:this.range.max+"px"})}});var t=t.Stage=h,h=D,u=m,G=common,H=!1,v=document.createElement("div"),ea=
$(v).css("display","block").addClass("loader"),fa=document.createElement("img");fa.src="../images/loader.gif";v.appendChild(fa);var na=u.loader={domElement:v,show:function(a){if(!H)return this;ea.fadeIn(150,function(){H=!1;(G.isFunction(a)?a:G.identity)()})},hide:function(a){if(H)return this;ea.fadeOut(150,function(){H=!0;(G.isFunction(a)?a:G.identity)()})}},ga=m.grid,n=common,O=$(document);$(window);u=function(){this.width=ga.getWidth(1);this.gutter=ga.gutter;this.$el=$('<div class="minimap" />');
this.domElement=this.$el[0];this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d");this.loader=na;this.viewport=$('<div class="viewport" />')[0];this.domElement.appendChild(this.viewport);this.domElement.appendChild(this.canvas);this.domElement.appendChild(this.loader.domElement);var a=n.bind(function(){O.bind("mousemove",c).bind("mouseup",b)},this),c=n.bind(function(a){a.preventDefault();a.stopPropagation();var b=this.$el.offset();Math.max(Math.min(a.pageX-b.left,this.width),
0);a=Math.max(Math.min(a.pageY-b.top,this.height),0);a=this.fromWorldY(a);O.scrollTop(a)},this),b=n.bind(function(){O.unbind("mousemove",c).unbind("mouseup",b)},this);$(this.domElement).bind("mousedown",a).bind("mouseup",function(a){c(a);b()})};n.extend(u.prototype,{appendTo:function(a){if(!n.isElement(a))return this;a.appendChild(this.domElement);return this},setStage:function(a){this.stage=a;return this},setGallery:function(a){this.gallery=a;return this},setOffset:function(a,c){n.extend(this.domElement.style,
{left:a+"px",top:c+"px"});return this},setHeight:function(a){if(a===this.height)return this;this.height=a;n.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});this.canvas.width=this.width;this.canvas.height=this.height;this.updateDisplay();return this},toWorldX:function(a){return Math.ceil(a/(this.stage.width/this.width))},toWorldY:function(a){return Math.ceil(a/(this.stage.height/this.height))},fromWorldX:function(a){return Math.ceil(a*(this.stage.width/this.width))},fromWorldY:function(a){return Math.ceil(a*
(this.stage.height/this.height))},update:function(){var a=$(this.stage.domElement);this.stage.width=a.width();this.stage.height=a.height()-this.stage.range.min;return this},updateDisplay:function(a,c){this.update();this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="#fff";var b=this.stage.offset.x/2;n.each(this.gallery.models,function(a){var c=this.toWorldX(a.left-b),e=this.toWorldY(a.top-this.stage.range.min),g=this.toWorldX(a.width),a=this.toWorldY(a.height)+6;this.ctx.fillRect(c,
e,g,a)},this);this.updateViewport(a,c);return this},updateViewport:function(a,c){n.extend(this.viewport.style,{top:this.toWorldY(a)+"px",height:this.toWorldY(c)+"px"});return this}});var h=h.Minimap=u,u=r,r=r.Events={bind:function(a,c){for(var b=a.split(" "),d=0,f=b.length;d<f;d++)a=b[d],this._callbacks||(this._callbacks={}),(this._callbacks[a]||(this._callbacks[a]=[])).push(c);return this},unbind:function(a,c){var b;if(a){if(b=this._callbacks)if(c){b=b[a];if(!b)return this;for(var d=0,f=b.length;d<
f;d++)if(c===b[d]){b.splice(d,1);break}}else b[a]=[]}else this._callbacks={};return this},trigger:function(a){var c,b,d,f;if(!(b=this._callbacks))return this;if(c=b[a]){d=0;for(f=c.length;d<f;d++)c[d].apply(this,Array.prototype.slice.call(arguments,1))}if(c=b.all){d=0;for(f=c.length;d<f;d++)c[d].apply(this,arguments)}return this}},w=common,v=function(a){w.isObject(a)&&this.add(a)};w.extend(v.prototype,r,{add:function(a,c){w.each(a,function(a,d){var f=d.charAt(0).toUpperCase()+d.substring(1).toLowerCase();
if(w.isUndefined(this[d]))this[d]=w.isObject(a)?w.clone(a):a,this["get"+f]=function(){return this[d]},this["set"+f]=function(a,b){if(a===this[d])return this;this[d]=a;b||this.trigger("change",d,a);return this};else this["set"+f](a,c)},this);return this}});var oa=u.Model=v,ha=m.grid,pa=m.label={add:function(a,c,b){var d=a.attr("alt"),f=!!b;if(d&&!(0>=d.length)){var b=marked(d),e=$('<div class="label image" />').html(b).appendTo(c||document.body),c=$(c||document.body),b=function(){var b,d,h;f?b={left:0,
top:0}:(d=c.offset().top,b=a.offset(),h=(a.outerWidth()-a.width())/2,d=(a.outerHeight()-a.height())/2-d,b={left:b.left+h+"px",top:b.top+d+"px"});e.css(b).fadeIn(150)},d=function(a){a=$(a.relatedTarget);!a.hasClass("image")&&!a.hasClass("label")&&e.fadeOut(150)};(f?c:a).hover(b,d).bind("touchstart",b).bind("touchend",d);return e}}},s=common,ia=function(a,c){var b=$(c||"<img />").attr("alt",a.title).css({display:"none"}).bind("load",function(){if(0===a.width){var c=Math.min(b.width(),ha.getWidth(11)),
d=b.height(),c=ha.snapWidth(c,d);b.width(c.x).height(c.y);a.setWidth(c.x);a.setHeight(c.y)}pa.add(b,b.parent(),!0);b.fadeIn()}),d=b[0];0!==a.width&&(d.width=a.width);0!==a.height&&(d.height=a.height);d.src=a.url;return d},qa=$(document),ja=0,A=function(){this.models=[];this.images=[]};s.extend(A,{MaxImages:50,Threshold:3600});s.extend(A.prototype,{add:function(a){a.id=ja;ja++;a=new oa(a);this.models.push(a);return a},areNeighbors:function(a,c){return a.neighbors&&0<a.neighbors.length&&0<=s.indexOf(a.neighbors,
c)},isNeighbors:function(a,c){return Math.abs(a.date-c.date)<A.Threshold},makeNeighbors:function(a,c){s.isArray(a.neighbors)||a.add({neighbors:[]});s.isArray(c.neighbors)||c.add({neighbors:[]});a.neighbors.push(c);c.neighbors.push(a)},hideImage:function(a){a=this.getImageById(a.id);s.isElement(a)&&$(a).fadeOut();return this},setStage:function(a){this.stage=a;return this},getImageForModel:function(a,c){var b=this.makeImage(a);c.children[0].appendChild(b);return this},makeImage:function(a){var c=this.images.length,
b=this.getImageById(a.id);if(s.isElement(b))return $(b).fadeIn()[0];if(c<A.MaxImages)return ia(a);b=this.getImageOffScreen();return ia(a,b)},getImageOffScreen:function(){for(var a,c=0,b=this.images.length;c<b;c++){var d=this.images[c],f=$(d).parent();0<f.length&&!f.hasClass("visible")&&(a=d)}return a},getImageById:function(a){return qa.find("[model="+a+"] img")[0]}});var r=D.Gallery=A,ra=m.grid,B=common,ka=function(){j.querying||j.cursor===j.total_pages&&0!==j.total_pages||(i.loader.show(),j.cursor++,
j.getAssetsForUser("jonobr1",P))},P=function(a){B.each(a.records,function(a){switch(a.asset_type){case "image":var b=a.content.resized_images,c=b.stash,g=b.display,h=c&&B.isObject(c.dims),j=g&&B.isObject(g.dims),i=h?c.dims.w:j?g.dims.w:0,c=h?c.dims.h:j?g.dims.h:0;if(0===i||0===c)break;i=ra.snapWidth(parseInt(i/2),parseInt(c/2));a=l.add({url:b.full,date:a.date,width:i.x,height:i.y,title:a.title,href:a.source});b=0;for(i=l.models.length;b<i;b++)c=l.models[b],a.id===c.id||(l.areNeighbors(a,c)||!l.isNeighbors(a,
c))||l.makeNeighbors(a,c)}});for(var a=0,c=l.models.length;a<c;a++){var b=l.models[a];b.placed||(b.add({placed:!0}),x.place(b))}a=I.height();K=0.9*a;L=0.1*a;a<=o?ka():(a=q-C,x.update(a,o),i.updateDisplay(a,o));i.loader.hide();J.trigger("resize")},J=$(window),I=$(document),Q=I.find("nav"),m=$("#content")[0],x=(new t).appendTo(m),i=(new h).appendTo(document.body),l=new r;x.setGallery(l);i.setGallery(l).setStage(x);l.setStage(x);var q=K=L=0,o=J.height(),C=Q.outerHeight(!0),R=Q.offset(),y;j.getAssetsForUser("jonobr1",
P);J.resize(function(){o=J.height();R=Q.offset();y=Math.max(C-q,i.gutter);i.setOffset(R.left+32,y).setHeight(o-y-i.gutter)}).trigger("resize");var sa=B.debounce(function(){x.update(q-C,o)},750);I.scroll(function(){var a=I.scrollTop();if(q<a)a+o>K&&ka();else if(q>a&&a<L&&!j.querying&&!(0===j.cursor||0<=B.indexOf(j.loaded,0)))i.loader.show(),j.cursor--,j.getAssetsForUser("jonobr1",P);q=a;y=Math.max(C-q,i.gutter);i.setOffset(R.left+32,y).setHeight(o-y-i.gutter).updateViewport(q-C,o);sa()})})();