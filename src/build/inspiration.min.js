(function(){var I,J,q=q||{},A=A||{},k=k||{},p=p||{},h=Array.prototype,ma=Object.prototype.hasOwnProperty,x=h.slice,R=h.forEach,S=h.indexOf,T=h.map,U=h.filter,K=Function.prototype.bind,V=function(){},W={},X=function(a,c){return ma.call(a,c)},B=function(a,c,b){if(null!=a)if(R&&a.forEach===R)a.forEach(c,b);else if(a.length===+a.length)for(var d=0,e=a.length;d<e&&!(d in a&&c.call(b,a[d],d,a)===W);d++);else for(d in a)if(X(a,d)&&c.call(b,a[d],d,a)===W)break},Y=function(a){return a},Z=function(a,c,b){b||
(b=Y);for(var d=0,e=a.length;d<e;){var f=d+e>>1;b(a[f])<b(c)?d=f+1:e=f}return d},aa=common={has:X,each:B,compact:function(a){var c=function(a){return!!a},b=[];null==a?a=b:U&&a.filter===U?a=a.filter(c,void 0):(B(a,function(a,e,f){c.call(void 0,a,e,f)&&(b[b.length]=a)}),a=b);return a},bind:function(a,c){var b,d;if(a.bind===K&&K)return K.apply(a,x.call(arguments,1));if(!this.isFunction(a))throw new TypeError;d=x.call(arguments,2);return b=function(){if(!(this instanceof b))return a.apply(c,d.concat(x.call(arguments)));
V.prototype=a.prototype;var e=new V,f=a.apply(e,d.concat(x.call(arguments)));return Object(f)===f?f:e}},extend:function(a){B(x.call(arguments,1),function(c){for(var b in c)a[b]=c[b]});return a},map:function(a,c,b){var d=[];if(null==a)return d;if(T&&a.map===T)return a.map(c,b);B(a,function(a,f,g){d[d.length]=c.call(b,a,f,g)});a.length===+a.length&&(d.length=a.length);return d},indexOf:function(a,c,b){if(null==a)return-1;var d;if(b)return b=Z(a,c),a[b]===c?b:-1;if(S&&a.indexOf===S)return a.indexOf(c);
b=0;for(d=a.length;b<d;b++)if(b in a&&a[b]===c)return b;return-1},sortedIndex:Z,identity:Y,after:function(a,c){return 0>=a?c():function(){if(1>--a)return c.apply(this,arguments)}},debounce:function(a,c,b){var d;return function(){var e=this,f=arguments;b&&!d&&a.apply(e,f);clearTimeout(d);d=setTimeout(function(){d=null;b||a.apply(e,f)},c)}},isElement:function(a){return!!(a&&1==a.nodeType)},isObject:function(a){return a===Object(a)},isNumber:function(a){return"[object Number]"==toString.call(a)},isFunction:function(a){return"[object Function]"==
toString.call(a)||"function"==typeof a},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a}},ba=[888,813,738,663,588,513,438,363,288,213,138,63],ca=[900,825,750,675,600,525,450,375,300,225,150,75,0];k.grid={gutter:12,width:75,columns:12,getPosition:function(a){return Math.max(Math.min(a,this.columns),0)*this.width},getWidth:function(a){return this.getPosition(a)-this.gutter},snapWidth:function(a,c){if(0===a)return{x:a,y:c};aa.isUndefined(c)&&(c=0);for(var b=a,d=c,e=0,f=
ba.length;e<f;e++){var g=ba[e];if(g<b){a=g;c=Math.floor(g*d/b);break}}return{x:a,y:c}},snapPosition:function(a,c){if(0===a)return{x:a,y:c};aa.isUndefined(c)&&(c=0);for(var b=a,d=c,e=0,f=ca.length;e<f;e++){var g=ca[e];if(g<b){a=g;c=Math.floor(g*d/b);break}}return{x:a,y:c}}};var na=common,L=[],n={loaded:L,querying:!1,limit:10,cursor:0,total_records:0,total_pages:0,getAssetsForUser:function(a,c){this.querying=!0;var b="https://gimmebar.com/api/v1/public/assets/"+a+("?skip="+this.cursor*this.limit)+("&limit="+
this.limit);0<=na.indexOf(L,this.cursor)||$.get("../php/get.php?q="+b,function(a){var a=JSON.parse(a),b=a.total_records;b&&n.total_records!==b&&(n.total_records=a.total_records,n.total_pages=Math.floor(n.total_records/n.limit));L.push(n.cursor);n.querying=!1;c(a)})}},i=q.api=n,q=A,da=k.grid,r=common,ea=0,h=function(){this.birthday=Math.round(Date.now()/1E3);this.$el=$('<div class="stage"/>');this.domElement=this.$el[0];this.offset={x:da.getPosition(1),y:0};this.range={min:0,max:0}};r.extend(h,{Id:"s-"});
r.extend(h.prototype,{appendTo:function(a){if(!r.isElement(a))return this;a.appendChild(this.domElement);r.extend(a.style,{overflow:"hidden"});return this},setGallery:function(a){this.gallery=a;return this},setMinimap:function(a){this.minimap=a;return this},place:function(a){var c;c=this.offset.x;var b=Math.round((this.birthday-a.date)/10-this.offset.y);a.width&&(c+=da.snapPosition(ea*(this.width-a.width-this.offset.x)).x,ea=Math.floor(7*Math.random())/6);b>this.range.max&&(this.range.max=b);if(b<
this.range.min||0===this.range.min)this.range.min=b;c={left:c,top:b};var d=$("<div />").addClass("moment").attr("model",a.id).css({position:"absolute",padding:"6px",background:"#d1d1d1"}).appendTo(this.domElement),b=function(){d.css({top:a.top+"px",left:a.left+"px",width:a.width+"px",height:a.height+"px"})};a.bind("change",b).add(c);b();this.updateDisplay();return d[0]},update:function(a,c){var b=a+c;r.each(this.gallery.models,function(d){var c=d.top-this.range.min,f=c+d.height,g=this.$el.find("[model="+
d.id+"]");g&&(c>b||f<a?(g.removeClass("visible"),this.gallery.hideImage(d,g[0])):(g.addClass("visible"),this.gallery.getImageForModel(d,g[0])))},this)},updateDisplay:function(){r.extend(this.domElement.style,{marginTop:-this.range.min+"px",height:this.range.max+"px"})}});var q=q.Stage=h,h=A,s=k,C=common,D=!1,t=document.createElement("div"),fa=$(t).css("display","block").addClass("loader"),ga=document.createElement("img");ga.src="../images/loader.gif";t.appendChild(ga);var oa=s.loader={domElement:t,
show:function(a){if(!D)return this;fa.fadeIn(150,function(){D=!1;(C.isFunction(a)?a:C.identity)()})},hide:function(a){if(D)return this;fa.fadeOut(150,function(){D=!0;(C.isFunction(a)?a:C.identity)()})}},ha=k.grid,l=common,M=$(document);$(window);s=function(){this.width=ha.getWidth(1);this.gutter=ha.gutter;this.$el=$('<div class="minimap" />');this.domElement=this.$el[0];this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d");this.loader=oa;this.viewport=$('<div class="viewport" />')[0];
this.domElement.appendChild(this.viewport);this.domElement.appendChild(this.canvas);this.domElement.appendChild(this.loader.domElement);var a=l.bind(function(){M.bind("mousemove",c).bind("mouseup",b)},this),c=l.bind(function(a){a.preventDefault();a.stopPropagation();var b=this.$el.offset();Math.max(Math.min(a.pageX-b.left,this.width),0);a=Math.max(Math.min(a.pageY-b.top,this.height),0);a=this.fromWorldY(a);M.scrollTop(a)},this),b=l.bind(function(){M.unbind("mousemove",c).unbind("mouseup",b)},this);
$(this.domElement).bind("mousedown",a)};l.extend(s.prototype,{appendTo:function(a){if(!l.isElement(a))return this;a.appendChild(this.domElement);return this},setStage:function(a){this.stage=a;return this},setGallery:function(a){this.gallery=a;return this},setOffset:function(a,c){l.extend(this.domElement.style,{left:a+"px",top:c+"px"});return this},setHeight:function(a){if(a===this.height)return this;this.height=a;l.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});this.canvas.width=
this.width;this.canvas.height=this.height;this.updateDisplay();return this},toWorldX:function(a){return Math.ceil(a/(this.stage.width/this.width))},toWorldY:function(a){return Math.ceil(a/(this.stage.height/this.height))},fromWorldX:function(a){return Math.ceil(a*(this.stage.width/this.width))},fromWorldY:function(a){return Math.ceil(a*(this.stage.height/this.height))},update:function(){var a=$(this.stage.domElement);this.stage.width=a.width();this.stage.height=a.height()-this.stage.range.min;return this},
updateDisplay:function(a,c){this.update();this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="#fff";var b=this.stage.offset.x/2;l.each(this.gallery.models,function(a){var c=this.toWorldX(a.left-b),f=this.toWorldY(a.top-this.stage.range.min),g=this.toWorldX(a.width-this.stage.offset.x),a=this.toWorldY(a.height);this.ctx.fillRect(c,f,g,a)},this);this.updateViewport(a,c);return this},updateViewport:function(a,c){l.extend(this.viewport.style,{top:this.toWorldY(a)+"px",height:this.toWorldY(c)+
"px"});return this}});var h=h.Minimap=s,s=p,p=p.Events={bind:function(a,c){for(var b=a.split(" "),d=0,e=b.length;d<e;d++)a=b[d],this._callbacks||(this._callbacks={}),(this._callbacks[a]||(this._callbacks[a]=[])).push(c);return this},unbind:function(a,c){var b;if(a){if(b=this._callbacks)if(c){b=b[a];if(!b)return this;for(var d=0,e=b.length;d<e;d++)if(c===b[d]){b.splice(d,1);break}}else b[a]=[]}else this._callbacks={};return this},trigger:function(a){var c,b,d,e;if(!(b=this._callbacks))return this;
if(c=b[a]){d=0;for(e=c.length;d<e;d++)c[d].apply(this,Array.prototype.slice.call(arguments,1))}if(c=b.all){d=0;for(e=c.length;d<e;d++)c[d].apply(this,arguments)}return this}},u=common,t=function(a){u.isObject(a)&&this.add(a)};u.extend(t.prototype,p,{add:function(a,c){u.each(a,function(a,d){var e=d.charAt(0).toUpperCase()+d.substring(1).toLowerCase();if(u.isUndefined(this[d]))this[d]=u.isObject(a)?u.clone(a):a,this["get"+e]=function(){return this[d]},this["set"+e]=function(a,b){if(a===this[d])return this;
this[d]=a;b||this.trigger("change",d,a);return this};else this["set"+e](a,c)},this);return this}});var pa=s.Model=t,ia=k.grid,E=common,ja=function(a,c){var b=$(c||"<img />").css({display:"none"}).bind("load",function(){if(0===a.width){var c=Math.min(b.width(),ia.getWidth(11)),d=b.height(),c=ia.snapWidth(c,d);b.width(c.x).height(c.y);a.setWidth(c.x);a.setHeight(c.y)}b.fadeIn()}),d=b[0];0!==a.width&&(d.width=a.width);0!==a.height&&(d.height=a.height);d.src=a.url;return d},qa=$(document),ka=0,F=function(){this.models=
[];this.images=[]};E.extend(F,{MaxImages:50});E.extend(F.prototype,{add:function(a){a.id=ka;ka++;a=new pa(a);this.models.push(a);return a},hideImage:function(a){a=this.getImageById(a.id);E.isElement(a)&&$(a).fadeOut();return this},setStage:function(a){this.stage=a;return this},getImageForModel:function(a,c){var b=this.makeImage(a);c.appendChild(b);return this},makeImage:function(a){var c=this.images.length,b=this.getImageById(a.id);if(E.isElement(b))return $(b).fadeIn()[0];if(c<F.MaxImages)return ja(a);
b=this.getImageOffScreen();return ja(a,b)},getImageOffScreen:function(){for(var a,c=0,b=this.images.length;c<b;c++){var d=this.images[c],e=$(d).parent();0<e.length&&!e.hasClass("visible")&&(a=d)}return a},getImageById:function(a){return qa.find("[model="+a+"]").children()[0]}});var p=A.Gallery=F,ra=k.grid,y=common,la=function(){i.querying||i.cursor===i.total_pages&&0!==i.total_pages||(j.loader.show(),i.cursor++,i.getAssetsForUser("jonobr1",N))},N=function(a){y.each(a.records,function(a){switch(a.asset_type){case "image":var b=
a.content.resized_images,d=b.stash,e=b.display,f=d&&y.isObject(d.dims),g=e&&y.isObject(e.dims),h=f?d.dims.h:g?e.dims.h:0,d=ra.snapWidth(parseInt(f?d.dims.w:g?e.dims.w:0),parseInt(h)),a=G.add({url:b.full,date:a.date,width:d.x,height:d.y});v.place(a)}});a=H.height();I=0.9*a;J=0.1*a;a<=m?la():(a=o-z,v.update(a,m),j.updateDisplay(a,m));j.loader.hide()},O=$(window),H=$(document),P=H.find("nav"),k=$("#content")[0],v=(new q).appendTo(k),j=(new h).appendTo(document.body),G=new p;v.setGallery(G);j.setGallery(G).setStage(v);
G.setStage(v);var o=I=J=0,m=O.height(),z=P.outerHeight(!0),Q=P.offset(),w;i.getAssetsForUser("jonobr1",N);O.resize(function(){m=O.height();Q=P.offset();w=Math.max(z-o,j.gutter);j.setOffset(Q.left,w).setHeight(m-w-j.gutter)}).trigger("resize");var sa=y.debounce(function(){v.update(o-z,m)},750);H.scroll(function(){var a=H.scrollTop();if(o<a)a+m>I&&la();else if(o>a&&a<J&&!i.querying&&!(0===i.cursor||0<=y.indexOf(i.loaded,0)))j.loader.show(),i.cursor--,i.getAssetsForUser("jonobr1",N);o=a;w=Math.max(z-
o,j.gutter);j.setOffset(Q.left,w).setHeight(m-w-j.gutter).updateViewport(o-z,m);sa()})})();