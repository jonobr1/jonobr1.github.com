(function(){var K,L,t=t||{},E=E||{},m=m||{},r=r||{},h=Array.prototype,ma=Object.prototype.hasOwnProperty,z=h.slice,T=h.forEach,U=h.indexOf,V=h.map,W=h.filter,M=Function.prototype.bind,X=function(){},Y={},Z=function(a,b){return ma.call(a,b)},F=function(a,b,c){if(null!=a)if(T&&a.forEach===T)a.forEach(b,c);else if(a.length===+a.length)for(var d=0,f=a.length;d<f&&!(d in a&&b.call(c,a[d],d,a)===Y);d++);else for(d in a)if(Z(a,d)&&b.call(c,a[d],d,a)===Y)break},aa=function(a){return a},ba=function(a,b,c){c||
(c=aa);for(var d=0,f=a.length;d<f;){var e=d+f>>1;c(a[e])<c(b)?d=e+1:f=e}return d},ca=common={has:Z,each:F,compact:function(a){var b=function(a){return!!a},c=[];null==a?a=c:W&&a.filter===W?a=a.filter(b,void 0):(F(a,function(a,f,e){b.call(void 0,a,f,e)&&(c[c.length]=a)}),a=c);return a},bind:function(a,b){var c,d;if(a.bind===M&&M)return M.apply(a,z.call(arguments,1));if(!this.isFunction(a))throw new TypeError;d=z.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,d.concat(z.call(arguments)));
X.prototype=a.prototype;var f=new X,e=a.apply(f,d.concat(z.call(arguments)));return Object(e)===e?e:f}},extend:function(a){F(z.call(arguments,1),function(b){for(var c in b)a[c]=b[c]});return a},map:function(a,b,c){var d=[];if(null==a)return d;if(V&&a.map===V)return a.map(b,c);F(a,function(a,e,g){d[d.length]=b.call(c,a,e,g)});a.length===+a.length&&(d.length=a.length);return d},indexOf:function(a,b,c){if(null==a)return-1;var d;if(c)return c=ba(a,b),a[c]===b?c:-1;if(U&&a.indexOf===U)return a.indexOf(b);
c=0;for(d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1},sortedIndex:ba,identity:aa,after:function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}},debounce:function(a,b,c){var d;return function(){var f=this,e=arguments;c&&!d&&a.apply(f,e);clearTimeout(d);d=setTimeout(function(){d=null;c||a.apply(f,e)},b)}},clone:function(a){return!this.isObject(a)?a:this.isArray(a)?a.slice():this.extend({},a)},isArray:Array.isArray||function(a){return"[object Array]"==toString.call(a)},
isElement:function(a){return!!(a&&1==a.nodeType)},isObject:function(a){return a===Object(a)},isNumber:function(a){return"[object Number]"==toString.call(a)},isFunction:function(a){return"[object Function]"==toString.call(a)||"function"==typeof a},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a}},da=[888,813,738,663,588,513,438,363,288,213,138,63],ea=[900,825,750,675,600,525,450,375,300,225,150,75,0];m.grid={gutter:12,width:75,columns:12,getPosition:function(a){return Math.max(Math.min(a,
this.columns),0)*this.width},getWidth:function(a){return this.getPosition(a)-this.gutter},snapWidth:function(a,b){if(0===a)return{x:a,y:b};ca.isUndefined(b)&&(b=0);for(var c=a,d=b,f=0,e=da.length;f<e;f++){var g=da[f];if(g<c){a=g;b=Math.floor(g*d/c);break}}return{x:a,y:b}},snapPosition:function(a,b){if(0===a)return{x:a,y:b};ca.isUndefined(b)&&(b=0);for(var c=a,d=b,f=0,e=ea.length;f<e;f++){var g=ea[f];if(g<c){a=g;b=Math.floor(g*d/c);break}}return{x:a,y:b}}};var na=common,N=[],p={loaded:N,querying:!1,
limit:10,cursor:0,total_records:0,total_pages:0,getAssetsForUser:function(a,b){this.querying=!0;var c="https://gimmebar.com/api/v1/public/assets/"+a+("?skip="+this.cursor*this.limit)+("&limit="+this.limit);0<=na.indexOf(N,this.cursor)||$.get("../php/get.php?q="+c,function(a){var a=JSON.parse(a),c=a.total_records;c&&p.total_records!==c&&(p.total_records=a.total_records,p.total_pages=Math.floor(p.total_records/p.limit));N.push(p.cursor);p.querying=!1;b(a)})}},j=t.api=p,t=E,G=m.grid,k=common,h=function(){this.birthday=
Math.round(Date.now()/1E3);this.$el=$('<div class="stage"/>');this.domElement=this.$el[0];this.offset={x:G.getPosition(2),y:0};this.range={min:0,max:0}};k.extend(h,{Id:"s-"});k.extend(h.prototype,{appendTo:function(a){if(!k.isElement(a))return this;a.appendChild(this.domElement);k.extend(a.style,{overflow:"hidden"});return this},setGallery:function(a){this.gallery=a;return this},setMinimap:function(a){this.minimap=a;return this},place:function(a){var b;b=this.offset.x;var c=Math.round((this.birthday-
a.date)/10-this.offset.y);if(0!==a.id&&k.isArray(a.neighbors)){for(var d=0,f=a.neighbors.length;d<f;d++){var e=a.neighbors[d];if(!k.isUndefined(e.top)&&!k.isUndefined(e.left)){var g=e.left,h=g+(e.width||0),j=e.top,e=j+(e.height||0);if(b+(a.width||0)>=g&&b<=h&&c+(a.height||0)>=j&&c<=e)if(g=G.snapPosition(h+G.width).x,900>g+(a.width||0)&&g>b)b=g}}d=0;for(f=a.neighbors.length;d<f;d++)if(e=a.neighbors[d],!k.isUndefined(e.top)&&!k.isUndefined(e.left)&&(g=e.left,h=g+(e.width||0),j=e.top,e=j+(e.height||
0),b+(a.width||0)>=g&&b<=h&&c+(a.height||0)>=j&&c<=e))c<e&&(c=e+G.gutter)}c>this.range.max&&(this.range.max=c);if(c<this.range.min||0===this.range.min)this.range.min=c;b={left:b,top:c};var i=$("<div />").addClass("moment").attr("model",a.id).css({position:"absolute",background:"#d1d1d1"}).appendTo(this.domElement);a.href&&i.html('<a href="'+a.href+'"></a>');c=function(){i.css({top:a.top+"px",left:a.left+"px",width:a.width+"px",height:a.height+"px"})};a.bind("change",c).add(b);c();this.updateDisplay();
return i[0]},update:function(a,b){var c=a+b;k.each(this.gallery.models,function(d){var b=d.top-this.range.min,e=b+d.height,g=this.$el.find("[model="+d.id+"]");0<g.length&&(b>c||e<a?(g.removeClass("visible"),this.gallery.hideImage(d,g[0])):(g.addClass("visible"),this.gallery.getImageForModel(d,g[0])))},this)},updateDisplay:function(){k.extend(this.domElement.style,{marginTop:-this.range.min+"px",height:this.range.max+"px"})}});var t=t.Stage=h,h=E,u=m,H=common,I=!1,v=document.createElement("div"),fa=
$(v).css("display","block").addClass("loader"),ga=document.createElement("img");ga.src="../images/loader.gif";v.appendChild(ga);var oa=u.loader={domElement:v,show:function(a){if(!I)return this;fa.fadeIn(150,function(){I=!1;(H.isFunction(a)?a:H.identity)()})},hide:function(a){if(I)return this;fa.fadeOut(150,function(){I=!0;(H.isFunction(a)?a:H.identity)()})}},ha=m.grid,n=common,O=$(document);$(window);u=function(){this.width=ha.getWidth(1);this.gutter=ha.gutter;this.$el=$('<div class="minimap" />');
this.domElement=this.$el[0];this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d");this.loader=oa;this.viewport=$('<div class="viewport" />')[0];this.domElement.appendChild(this.viewport);this.domElement.appendChild(this.canvas);this.domElement.appendChild(this.loader.domElement);var a=n.bind(function(){O.bind("mousemove",b).bind("mouseup",c)},this),b=n.bind(function(a){a.preventDefault();a.stopPropagation();var c=this.$el.offset();Math.max(Math.min(a.pageX-c.left,this.width),
0);a=Math.max(Math.min(a.pageY-c.top,this.height),0);a=this.fromWorldY(a);O.scrollTop(a)},this),c=n.bind(function(){O.unbind("mousemove",b).unbind("mouseup",c)},this);$(this.domElement).bind("mousedown",a).bind("mouseup",function(a){b(a);c()})};n.extend(u.prototype,{appendTo:function(a){if(!n.isElement(a))return this;a.appendChild(this.domElement);return this},setStage:function(a){this.stage=a;return this},setGallery:function(a){this.gallery=a;return this},setOffset:function(a,b){n.extend(this.domElement.style,
{left:a+"px",top:b+"px"});return this},setHeight:function(a){if(a===this.height)return this;this.height=a;n.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});this.canvas.width=this.width;this.canvas.height=this.height;this.updateDisplay();return this},toWorldX:function(a){return Math.ceil(a/(this.stage.width/this.width))},toWorldY:function(a){return Math.ceil(a/(this.stage.height/this.height))},fromWorldX:function(a){return Math.ceil(a*(this.stage.width/this.width))},fromWorldY:function(a){return Math.ceil(a*
(this.stage.height/this.height))},update:function(){var a=$(this.stage.domElement);this.stage.width=a.width();this.stage.height=a.height()-this.stage.range.min;return this},updateDisplay:function(a,b){this.update();this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle="#fff";var c=this.stage.offset.x/2;n.each(this.gallery.models,function(a){var b=this.toWorldX(a.left-c),e=this.toWorldY(a.top-this.stage.range.min),g=this.toWorldX(a.width),a=this.toWorldY(a.height)+6;this.ctx.fillRect(b,
e,g,a)},this);this.updateViewport(a,b);return this},updateViewport:function(a,b){n.extend(this.viewport.style,{top:this.toWorldY(a)+"px",height:this.toWorldY(b)+"px"});return this}});var h=h.Minimap=u,u=r,r=r.Events={bind:function(a,b){for(var c=a.split(" "),d=0,f=c.length;d<f;d++)a=c[d],this._callbacks||(this._callbacks={}),(this._callbacks[a]||(this._callbacks[a]=[])).push(b);return this},unbind:function(a,b){var c;if(a){if(c=this._callbacks)if(b){c=c[a];if(!c)return this;for(var d=0,f=c.length;d<
f;d++)if(b===c[d]){c.splice(d,1);break}}else c[a]=[]}else this._callbacks={};return this},trigger:function(a){var b,c,d,f;if(!(c=this._callbacks))return this;if(b=c[a]){d=0;for(f=b.length;d<f;d++)b[d].apply(this,Array.prototype.slice.call(arguments,1))}if(b=c.all){d=0;for(f=b.length;d<f;d++)b[d].apply(this,arguments)}return this}},w=common,v=function(a){w.isObject(a)&&this.add(a)};w.extend(v.prototype,r,{add:function(a,b){w.each(a,function(a,d){var f=d.charAt(0).toUpperCase()+d.substring(1).toLowerCase();
if(w.isUndefined(this[d]))this[d]=w.isObject(a)?w.clone(a):a,this["get"+f]=function(){return this[d]},this["set"+f]=function(a,c){if(a===this[d])return this;this[d]=a;c||this.trigger("change",d,a);return this};else this["set"+f](a,b)},this);return this}});var pa=u.Model=v,ia=m.grid,qa=m.label={add:function(a,b,c){var d=a.attr("alt"),f=!!c;if(d&&!(0>=d.length)){var c=marked(d),e=$('<div class="label image" />').html(c).appendTo(b||document.body),b=$(b||document.body),c=function(){var c,d,h;f?c={left:0,
top:0}:(d=b.offset().top,c=a.offset(),h=(a.outerWidth()-a.width())/2,d=(a.outerHeight()-a.height())/2-d,c={left:c.left+h+"px",top:c.top+d+"px"});e.css(c).fadeIn(150)},d=function(a){a=$(a.relatedTarget);!a.hasClass("image")&&!a.hasClass("label")&&e.fadeOut(150)};(f?b:a).hover(c,d).bind("touchstart",c).bind("touchend",d);return e}}},s=common,ja=function(a,b){var c=$(b||"<img />").attr("alt",a.title).css({display:"none"}).bind("load",function(){if(0===a.width){var b=Math.min(c.width(),ia.getWidth(11)),
d=c.height(),b=ia.snapWidth(b,d);c.width(b.x).height(b.y);a.setWidth(b.x);a.setHeight(b.y)}qa.add(c,c.parent(),!0);c.fadeIn()}),d=c[0];0!==a.width&&(d.width=a.width);0!==a.height&&(d.height=a.height);d.src=a.url;return d},ra=$(document),ka=0,A=function(){this.models=[];this.images=[]};s.extend(A,{MaxImages:50,Threshold:3600});s.extend(A.prototype,{add:function(a){a.id=ka;ka++;a=new pa(a);this.models.push(a);return a},areNeighbors:function(a,b){return a.neighbors&&0<a.neighbors.length&&0<=s.indexOf(a.neighbors,
b)},isNeighbors:function(a,b){return Math.abs(a.date-b.date)<A.Threshold},makeNeighbors:function(a,b){s.isArray(a.neighbors)||a.add({neighbors:[]});s.isArray(b.neighbors)||b.add({neighbors:[]});a.neighbors.push(b);b.neighbors.push(a)},hideImage:function(a){a=this.getImageById(a.id);s.isElement(a)&&$(a).fadeOut();return this},setStage:function(a){this.stage=a;return this},getImageForModel:function(a,b){var c=this.makeImage(a);b.children[0].appendChild(c);return this},makeImage:function(a){var b=this.images.length,
c=this.getImageById(a.id);if(s.isElement(c))return $(c).fadeIn()[0];if(b<A.MaxImages)return ja(a);c=this.getImageOffScreen();return ja(a,c)},getImageOffScreen:function(){for(var a,b=0,c=this.images.length;b<c;b++){var d=this.images[b],f=$(d).parent();0<f.length&&!f.hasClass("visible")&&(a=d)}return a},getImageById:function(a){return ra.find("[model="+a+"] img")[0]}});var r=E.Gallery=A,sa=m.grid,B=common,la=function(){j.querying||j.cursor===j.total_pages&&0!==j.total_pages||(i.loader.show(),j.cursor++,
j.getAssetsForUser("jonobr1",P))},P=function(a){B.each(a.records,function(a){switch(a.asset_type){case "image":var c=a.content.resized_images,b=c.stash,g=c.display,h=b&&B.isObject(b.dims),j=g&&B.isObject(g.dims),i=h?b.dims.w:j?g.dims.w:0,b=h?b.dims.h:j?g.dims.h:0;if(0===i||0===b)break;i=sa.snapWidth(parseInt(i/2),parseInt(b/2));a=l.add({url:c.full,date:a.date,width:i.x,height:i.y,title:a.title,href:a.source});c=0;for(i=l.models.length;c<i;c++)b=l.models[c],a.id===b.id||(l.areNeighbors(a,b)||!l.isNeighbors(a,
b))||l.makeNeighbors(a,b)}});for(var a=0,b=l.models.length;a<b;a++){var c=l.models[a];c.placed||(c.add({placed:!0}),x.place(c))}a=C.height();K=0.9*a;L=0.1*a;a<=o?la():(a=q-D,x.update(a,o),i.updateDisplay(a,o));i.loader.hide();J.trigger("resize")},J=$(window),C=$(document),Q=C.find("nav"),m=$("#content")[0],x=(new t).appendTo(m),i=(new h).appendTo(document.body),l=new r;x.setGallery(l);i.setGallery(l).setStage(x);l.setStage(x);var q=K=L=0,R=0,o=J.height(),D=Q.outerHeight(!0),S=Q.offset(),y;j.getAssetsForUser("jonobr1",
P);J.resize(function(){o=J.height();S=Q.offset();y=Math.max(D-q,i.gutter);i.setOffset(S.left+32-R,y).setHeight(o-y-i.gutter)}).trigger("resize");var ta=B.debounce(function(){x.update(q-D,o)},750);C.scroll(function(){var a=C.scrollTop(),b=C.scrollLeft();if(q<a)a+o>K&&la();else if(q>a&&a<L&&!j.querying&&!(0===j.cursor||0<=B.indexOf(j.loaded,0)))i.loader.show(),j.cursor--,j.getAssetsForUser("jonobr1",P);R=b;q=a;y=Math.max(D-q,i.gutter);i.setOffset(S.left+32-R,y).setHeight(o-y-i.gutter).updateViewport(q-
D,o);ta()})})();